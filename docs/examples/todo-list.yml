$(#root): app

app:
  - yx-from: input
    id: item-desc
    placeholder: "Item description"
  - yx-button: "Add"
    hx-push: "/add-item"
    hx-vals: 'js:{desc: document.getElementById("item-desc").value}'
    hx-target: "#item-list"
  - yx-ul: null
    id: "item-list"

$add-item:
  yx-from: sql
  query: INSERT INTO todo_items (description) VALUES ($desc); SELECT id, description FROM todo_items;

add-item:
  yx-from: list-item

list-item:
  yx-from: li
  class: flex justify-between items-center p-2 border-b
  id: "item-$id"
  children:
    - span: $description
    - yx-button: "Delete"
      hx-push: "/delete-item"
      hx-vals: 'js:{id: $id}'
      hx-target: "#item-list"

$delete-item:
  yx-from: sql
  query: DELETE FROM todo_items WHERE id = $id; SELECT id, description FROM todo_items;

delete-item:
  yx-from: list-item